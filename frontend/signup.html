<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>회원 가입</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .gender-options {
      display: flex;
      gap: 10px; /* 간격 좁힘 */
      margin-top: 10px;
    }

    .gender-options label {
      font-weight: normal;
    }

    input[type="radio"] {
        accent-color: green;
    }

    .level-options {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .level-options label {
      font-weight: normal;
      font-size: 0.9em;
      cursor: pointer;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    .back-btn {
      background-color: white;
      color: green;
      border: 1px solid green;
      flex: 1;
      margin-right: 10px;
    }

    .submit-btn {
      background-color: green;
      color: white;
      flex: 1;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h2>회원 가입</h2>
  <form id="signupForm">
    <label for="user_id">아이디</label>
    <input type="text" id="user_id" name="user_id" required />

    <label>성별 (필수)</label>
    <div class="gender-options">
      <label><input type="radio" name="gender" value="남성" required checked/> 남성</label>
      <label><input type="radio" name="gender" value="여성" required /> 여성</label>
    </div>

    <label for="age">나이</label>
    <input type="number" id="age" name="age" required min="1" />

    <label for="height">키 (cm)</label>
    <input type="number" id="height" name="height" required min="1" />

    <label for="weight">체중 (kg)</label>
    <input type="number" id="weight" name="weight" required min="1" />

    <label>운동 수준</label>
    <div class="level-options">
      <label><input type="radio" name="level" value="1" required checked/> 1 - 운동을 모른다. (운동 머신 기본 조작법 미숙)</label>
      <label><input type="radio" name="level" value="2" required /> 2 - 입문자, 바른 자세를 모른다 (운동 머신 기본 조작법 능숙)</label>
      <label><input type="radio" name="level" value="3" required /> 3 - 초보자, 머신으로 단순 반복 운동 가능</label>
      <label><input type="radio" name="level" value="4" required /> 4 - 중급자, 머신으로 다양한 동작 수행 가능</label>
      <label><input type="radio" name="level" value="5" required /> 5 - 전문가, 타인을 가르칠 수 있다.</label>
    </div>

    <label for="injury">부상이 있으신가요?</label>
    <textarea style="resize: none;"
      id="injury"
      name="injury"
      rows="3"
      placeholder="부위나 수준을 입력하세요."
    ></textarea>

    <div class="button-group">
      <button type="button" class="back-btn" onclick="history.back()">뒤로가기</button>
      <button type="submit" class="submit-btn">가입하기</button>
    </div>
  </form>

  <script>
    document
      .getElementById("signupForm")
      .addEventListener("submit", async function (event) {
        event.preventDefault();
        const formData = new FormData(this);

        const data = {
          user_id: formData.get("user_id"),
          gender: formData.get("gender"),
          age: parseInt(formData.get("age")),
          height: parseFloat(formData.get("height")),
          weight: parseFloat(formData.get("weight")),
          level: parseInt(formData.get("level")),
          injury_level: formData.get("injury"),
          injury_part: formData.get("injury"),
        };

        try {
          const response = await fetch("http://localhost:8000/users/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (!response.ok) {
            const error = await response.json();
            alert(error.detail || "회원가입 중 오류 발생");
            return;
          }

          const result = await response.json();
          alert(result.message || "가입 완료!");
          window.location.href = "index.html"; // 로그인 페이지로 이동
        } catch (err) {
          alert("회원가입 중 오류 발생");
          console.error(err);
        }
      });
  </script>
</body>
</html>